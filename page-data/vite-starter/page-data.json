{"componentChunkName":"component---src-templates-blog-post-js","path":"/vite-starter/","result":{"data":{"site":{"siteMetadata":{"title":"블로그 공사중"}},"markdownRemark":{"id":"1e1efec4-15c2-567b-9ba6-2ffcd251a752","excerpt":"기존 레포를 vite로 마이그레이션 할 일이 있어서 vite를 처음 써 봤는데, 기존 방식과 달라서 헤맸었다. 관련된 내용 정리. vite? 번들러(bundler) 툴이다. 디펜던시들을 사전 번들링(esbuild로 한다) 하고, 소스코드들은 rollup…","html":"<p>기존 레포를 vite로 마이그레이션 할 일이 있어서 vite를 처음 써 봤는데, 기존 방식과 달라서 헤맸었다. 관련된 내용 정리.</p>\n<h2>vite?</h2>\n<p>번들러(bundler) 툴이다. 디펜던시들을 사전 번들링(esbuild로 한다) 하고, 소스코드들은 rollup으로 번들링한다.\n그래서 webpack 같은 기존 툴보다 훨씬 빠르다고 주장하는데, 반대로 esbuild만 쓰다 vite를 쓰게 되면 훨씬 느려진 것을 체감할 수 있다...</p>\n<p>vite 측에선 rollup의 유연성을 위해 채택했다고 하는데, 사실 개인적으로도 맞는 판단이라고 생각한다.\nesbuild는 진짜 뭐 없다. code spliting, TS type check 등의 기능들도 지원하지 않는다. 걍 빠르고 끝.\n물론 esbuild 또한 점점 이것저것 개발하고 있다고 하는데, 아직은 기능들이 빈약한 것은 어쩔 수 없는 듯.</p>\n<h2>vite 기본 구조</h2>\n<p>vite.config.ts에서 build.input 파라미터 안에 entrypoint 가 될 <code>index.html</code> 파일 위치를 넣고,\nhtml 파일엔 import할 js/css path를 넣으면, vite가 알아서 번들링을 착착 해 준다.</p>\n<p>나머지 asset들도 잘 정리해주고,\nchunk split(라이브러리 등을 다른 파일로 분리해서 배포하는 방법 - 라이브러리들을 따로 캐싱하고 싶을 때 주로 사용함)도\n잘 지원해줘서 생각보다 사용하기 편하다.</p>\n<deckgo-highlight-code language=\"html\"  >\n          <code slot=\"code\">&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;en&quot;&gt;\n  &lt;head&gt;\n    &lt;meta charset=&quot;UTF-8&quot; /&gt;\n    &lt;link rel=&quot;icon&quot; type=&quot;image/svg+xml&quot; href=&quot;/vite.svg&quot; /&gt;\n    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;\n    &lt;title&gt;Vite + TS&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;\n    &lt;script type=&quot;module&quot; src=&quot;./src/main.ts&quot;&gt;&lt;/script&gt;\n  &lt;/body&gt;\n&lt;/html&gt;</code>\n        </deckgo-highlight-code>\n<p>여러 html 파일들을 entrypoint로 쓸 경우엔</p>\n<deckgo-highlight-code language=\"typescript\"  >\n          <code slot=\"code\">  build: {\n    rollupOptions: {\n      input: {\n        main: path.resolve(__dirname, &#39;index.html&#39;),\n        sub: path.resolve(__dirname, &#39;sub/index.html&#39;),\n      },\n      ...\n    },\n  }</code>\n        </deckgo-highlight-code>\n<p>이런 식으로 정리할 수 있다.</p>\n<h2>문제</h2>\n<p>문제는 entrypoint html 파일들이 생성되는 path를 각각 파일들마다 커스텀 할 수 없다는 것이다.\n무조건 해당 html file path를 따라 dist에 번들된다.\n그래서 처음부터 vite를 쓴다면 상관 없겠지만, 기존 프로젝트에서 번들러를 바꾸려 할 때 문제가 생겼다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 364px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dbe8c221f8d6d8a4bd15e1cdefc855d5/e45a9/structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 116.45569620253164%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAIAAACEf/j0AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACQklEQVR42o2U646bMBCF9w02BHs8Q4yBEBwwFxuyCZCLWnUr9fKrUlWp7/8kFURVpWqTzfz/dI5nzvETEcVxfOiH0hSe5yESPjxPiChluNlsTFkWeU70H0zvwEEQbDZp23bOOgAQQlwx4gwB7vBPiELKUGc6yzJTlq+vr+k6ASEIGGsGEWcI/Bb/NEtQFEXGmK7r0jQV0yBxBrr2Pvwk5iPdhpEoVmFZFNY6Oc9qtUIKaPnsD1+4eSG2fJOfYIG0JtjGcveyPwzDeDp1ziEhsSXo2h++0vIZKbi5sFCpvCiNKWAeIWBWXjB3Yu2FfO+mMhKtVViZom7qKIrWaRrHMQoQYeR9+j1j4u03EyKgiJDrOHRd1+12+763dUNsydoLN929hTHwG32w5lA1dV3XOsu8xYJzfnX0zp0FinW0qfLG2sZaV1VVprMkSR5KGBGpSOV57qwzxjjn+mEwpnww21Mx6qo6jietM8YY53za9oPKcZxUVa21llIiin/dAHg326iU2uZ5KFcAf09CRNxn7QXSYqrHrWwLIaSUmd6Ox2NZGs75rEwIDNLC+/jrHnwVStbrummstUEQgAAxRXbO9uEza473EkYUqFCaIndtq5QKgmAuxuQcssofv92E5+xRSpAn4W6/Pwz98XzeufZaDJ5bv/9C/uJuMaJI54UpimsrYCo0kb9Yjt/5tiHu37FNUSgrY8qqXK1WSikZKuKMb+3y8oOYd+8zmGwHYNKoH8Z+HI/nc+fcdKp6EImev6G37/wHwNKbeyXESbQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"structure.png\"\n        title=\"\"\n        src=\"/static/dbe8c221f8d6d8a4bd15e1cdefc855d5/e45a9/structure.png\"\n        srcset=\"/static/dbe8c221f8d6d8a4bd15e1cdefc855d5/c26ae/structure.png 158w,\n/static/dbe8c221f8d6d8a4bd15e1cdefc855d5/6bdcf/structure.png 315w,\n/static/dbe8c221f8d6d8a4bd15e1cdefc855d5/e45a9/structure.png 364w\"\n        sizes=\"(max-width: 364px) 100vw, 364px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>html plugin들을 싹 다 살펴봤지만, 대부분 특정 html 파일들을 각각 원하는 path로 보낼 수 있는 기능을 지원하거나 하지는 않았다.\n<code>@open-wc/rollup-plugin-html</code> 플러그인을 사용하면 억지로 가능하긴 한데 중복으로 번들링을 한다던지 하는 문제가 있어서 패스.\n애초에 이럴 때 쓰라고 있는 플러그인이 아니라 그런 듯 하다.</p>\n<p>결국 포기하고 html 파일 구조를 변경하는 것으로 마무리. 더 좋은 방법을 찾지 못했다.</p>","frontmatter":{"title":"Vite에서 entrypoint html 다루기","date":"May 16, 2023","description":"Vite에서 entrypoint 관련해서 골치아팠던 일 복기"}},"previous":{"fields":{"slug":"/threejs-dispose/"},"frontmatter":{"title":"Three.js 에서 dispose()는 어떻게 작동할까?"}},"next":null},"pageContext":{"id":"1e1efec4-15c2-567b-9ba6-2ffcd251a752","previousPostId":"3bdd47f6-b1f4-5502-988d-8101103e4639","nextPostId":null}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}