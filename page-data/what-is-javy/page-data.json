{"componentChunkName":"component---src-templates-blog-post-js","path":"/what-is-javy/","result":{"data":{"site":{"siteMetadata":{"title":"블로그 공사중"}},"markdownRemark":{"id":"edfbf6bc-63de-53e4-a257-607716c74763","excerpt":"GeekNews를 보던 중 Javy라는 물건을 발견했다. Javy? JS 코드를 웹 어셈블리(이하 WASM)에서 돌릴 수 있도록 만들어 주는 툴 체인이다.\nJS 코드를 가져온 뒤, WASM에 임베드 된 JS 런타임으로 실행을 하며,\ndynamic linking…","html":"<p><a href=\"https://news.hada.io/topic?id=9289\">GeekNews</a>를 보던 중 <a href=\"https://github.com/bytecodealliance/javy\">Javy</a>라는 물건을 발견했다.</p>\n<h2>Javy?</h2>\n<p>JS 코드를 웹 어셈블리(이하 WASM)에서 돌릴 수 있도록 만들어 주는 툴 체인이다.\nJS 코드를 가져온 뒤, WASM에 임베드 된 JS 런타임으로 실행을 하며,\ndynamic linking을 사용하면 아주 작은 크기의 웹어셈 모듈을 만들 수 있다고 한다.\n즉, JS 코드를 가져와서 WASM 위에 올리고, 그걸 다시 node로 돌릴 수 있다는 뜻이다!</p>\n<p>....??</p>\n<h2>대체 왜 이런 짓을 하는가?</h2>\n<p>처음 보면 이해가 잘 안 되는 광경일 수 있다. 사실 나도 그랬다.\n기껏 JS로 코드를 짜놓고 WASM 모듈로 올린다니? 그냥 JS로 쓰면 되잖아?\n그 이유를 알기 위해 Javy의 역사를 잠시 훑어 볼 필요가 있다.</p>\n<p>Javy는 원래 Shopify에서 만든 오픈소스 프로젝트였다.\n그 뒤, 현재는 <a href=\"https://bytecodealliance.org/\">Bytecode Alliance</a>에서 관리하고 있다.\nShopify는 온라인 이커머스 플랫폼으로,\n쇼핑몰을 간단하게 만들 수 있도록 도와주는 일을 주로 하고 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1a28242ce5be02f2f6a3070e75f0d136/c1b63/shopify_logo.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABb0lEQVR42o2S30vCUBTH/Wt6q3/EhhQJUexBSfeS4JMIQY89KPTSS7JgzMIJoTMJwpdelpmCSRN/5CIVjSm0RWjobPeesK2xfPL7dM/l+znn3nOOA2zCgDFgWFoOE8NYR5qOtH+5MF4IMcYIoUUYABpyrvgaV8fyrw8hhAyrJSOXcWmcTbjcTV6W92lhM8Q6pbe6YRJFcTqdWk8YjUbValUQBKv4HB5r78kSJfavuJJ/93j1rpGTewM2zlIURdM0x3Esy8ZiMYZhfD5fIBBIp9OSJJmw/FnPVEJdpXgmbG1H124qXLn4uE44w+EwSZJer5cgCI/H43a7g8Egz/Mul0tRFBN+Ht5yJX9frTD5nY2jlZPrw4E8LBTum81mq9Wq1WqRSCSVSrXb7U6nk81mE4kEACCE5vDHV++px+dfTi8KewfnZOYhbm8vAEwmE+ufqqpqmrbYbQDQ0ewbzewttWZjhfYROv5K6PZVWXJJfgASDg1pMF9TIAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"shopify_logo.png\"\n        title=\"\"\n        src=\"/static/1a28242ce5be02f2f6a3070e75f0d136/f058b/shopify_logo.png\"\n        srcset=\"/static/1a28242ce5be02f2f6a3070e75f0d136/c26ae/shopify_logo.png 158w,\n/static/1a28242ce5be02f2f6a3070e75f0d136/6bdcf/shopify_logo.png 315w,\n/static/1a28242ce5be02f2f6a3070e75f0d136/f058b/shopify_logo.png 630w,\n/static/1a28242ce5be02f2f6a3070e75f0d136/40601/shopify_logo.png 945w,\n/static/1a28242ce5be02f2f6a3070e75f0d136/c1b63/shopify_logo.png 1200w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>그러면 더욱 더 이해가 안 가기 시작한다. 쇼핑몰 플랫폼에서 왜 이런 걸 내놓았을까?</p>\n<p>Shopify에서 내놓은 기능인 Shopify Functions 때문이다.\n이게 무엇인고 하니, 유저가 운영하는 쇼핑몰의 백엔드 로직을 커스터마이징 할 수 있는 기능이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/de367b4d2fa3d6004bc838ee4f611434/c4842/shopify_functions.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.41772151898735%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACeklEQVR42lVUXW/bMAz0/38dMGDD/sCeu75sA4phGPJSoEDXYl2ypfmo4zS2JcuSKMl2cwPpJEsNHGSZ0el4JJORd/h1f4M9gEop1EohxgQKESGMa9f3IIrwhz1RQAjhFC/LEkrV0E2DLM/XePvhDfgxpsV6tUZZ7mBah0o1cM5BKSUk1gco3WC5XKIoClS1RogR83WBq8kdHBEyYwxmsxlS6uApgPdaN2itR9M6eCIorSXGhLVusFqtsVqvsN2V8CFivswxuf6J1nlkXdfJLf0wSNBTBIUk7xQTrCc0rUXrSFLmeGPs+M16OE8w1gssExIRpne32L/shUAOHcCKvCc468Qr3jMBn4kxCqn1Ed4ZqO0UoRuQ1WWFj+/eY+j7E4mjeEJVVVgsFmiMQa0NaqXx/LzFbrcTPy0l7LY5/t5PhDzz3uMpL5C6DhQ7OHqt0FoH5zxaayWtltVSAAUukBELnjZb3D/8Ec+zYRjAeHnZIyb28z/EQ/aOC+JI9nwpe8zxYyz1A/p+QOx6Vuhwe/0dKZH8+Dxlrpq1FkppUckKuDgMaaGmlUuWTxtcfrlCZA855cuLC4TgQbE/EfKqGytt9Pg4l9S5L7WxJ7CnIfXINzkmk2+IaRirXBRbdF0vaRw9HBWSVJUnwEmFg6R7jpDG1PlCHwIyHJ79fv/aPyb1o0eyHpSLhwf42KHrB6jWY7opkdjDkDyuH75KUY7KRJ0P4pk9jB5bI4rPWopt4TlfbCt8vvktRc0cGfy4/TT+AcTXfSgTYIz0YllWsj8nHEkJs79zTKcz5MUzMu54XTdCyGUnbp0DxjZJ0nd1reRwOIsfUSktc22swz/lEXt6rYRCVQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"shopify_functions.png\"\n        title=\"\"\n        src=\"/static/de367b4d2fa3d6004bc838ee4f611434/f058b/shopify_functions.png\"\n        srcset=\"/static/de367b4d2fa3d6004bc838ee4f611434/c26ae/shopify_functions.png 158w,\n/static/de367b4d2fa3d6004bc838ee4f611434/6bdcf/shopify_functions.png 315w,\n/static/de367b4d2fa3d6004bc838ee4f611434/f058b/shopify_functions.png 630w,\n/static/de367b4d2fa3d6004bc838ee4f611434/40601/shopify_functions.png 945w,\n/static/de367b4d2fa3d6004bc838ee4f611434/78612/shopify_functions.png 1260w,\n/static/de367b4d2fa3d6004bc838ee4f611434/c4842/shopify_functions.png 1634w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n스토어 파이프라인을 자기 입맛대로 바꿀 수 있도록 해 주는 굉장히 신기한 서비스인데, 이걸 구현하기 위해 WASM이 쓰였다고 한다.\nWASM의 특징 중 하나인 샌드박스가 유용하게 쓰인 모양. 물론 브라우저 밖에서 사용하는 것이니 WASI를 활용했다.\n따라서 WASM과 잘 맞는 rust를 기본 언어로 사용하는 Shopify Functions를 출시하게 된다.</p>\n<p>하지만 문제가 하나 있는데, 대부분의 웹 개발자들은 rust를 쓸 줄 모른다는 사실!\n다들 JS를 주로 쓰는데 이것 때문에 rust를 입문하기엔 rust의 진입장벽이 너무 높다.\n따라서 Shopify는 WASM에 JS를 올린다는 발상을 실천으로 옮기게 되는데...</p>\n<blockquote>\n<p>However, at the time of writing, WebAssembly’s architecture makes JIT-ing impossible. There’s no way for Wasm to generate and then execute code, as the memory storing the instructions is completely inaccessible to the module itself. This is by design: By preventing any code that wasn’t present during module instantiation from being executed, almost all remote code execution vulnerabilities become impossible.</p>\n</blockquote>\n<p>아뿔사, 그냥 기존의 JS 엔진을 가져오려 했지만 WASM에선 JIT가 불가능하다는 문제에 직면했다.\n보안 이슈로 막아놓은 것. 따라서 다른 대안을 찾아야 했다.</p>\n<p>그렇게 찾은 대안은 바로 <a href=\"https://bellard.org/quickjs/\">QuickJS</a>.\nC로 구현한 JS 엔진이다. ES2020 까지 지원한다.\nC이기 때문에 WASM 위에 올라간다!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6f888a055caf756c59f233c758751da7/212bf/javy_dynamic.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.316455696202528%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHcrKJAf//EABYQAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAQABBQJJUR2//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFhEBAQEAAAAAAAAAAAAAAAAAAAEC/9oACAECAQE/Acq//8QAFxABAQEBAAAAAAAAAAAAAAAAAAERMf/aAAgBAQAGPwLqTVf/xAAZEAADAQEBAAAAAAAAAAAAAAAAAREhMUH/2gAIAQEAAT8hZJQj2H2ofp44f//aAAwDAQACAAMAAAAQh9//xAAVEQEBAAAAAAAAAAAAAAAAAAABAP/aAAgBAwEBPxABZv/EABcRAAMBAAAAAAAAAAAAAAAAAAABIRH/2gAIAQIBAT8Qp0TGf//EABoQAQADAAMAAAAAAAAAAAAAAAEAESFRYXH/2gAIAQEAAT8QZUXeXC+qasXYxzYrwn//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"javy_dynamic.jpg\"\n        title=\"\"\n        src=\"/static/6f888a055caf756c59f233c758751da7/828fb/javy_dynamic.jpg\"\n        srcset=\"/static/6f888a055caf756c59f233c758751da7/ff44c/javy_dynamic.jpg 158w,\n/static/6f888a055caf756c59f233c758751da7/a6688/javy_dynamic.jpg 315w,\n/static/6f888a055caf756c59f233c758751da7/828fb/javy_dynamic.jpg 630w,\n/static/6f888a055caf756c59f233c758751da7/212bf/javy_dynamic.jpg 768w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n따라서 JS 스크립트를 받은 뒤, QuickJS를 통해 QuickJS 바이트코드로 변환하고,\n그걸 WASM 위에 올린 뒤 실행하는 엄청난 마개조가 완성되었다.</p>\n<h2>결론</h2>\n<p>처음 봤을 땐 이런 물건이 나온 이유를 짐작하기 힘들었는데, 역시 다 이유가 있었다.\n나름 합리적인 이유로 재미있는 결과가 나왔다는 게 굉장히 흥미로웠다.\n적정기술의 훌륭한 예를 볼 수 있었던 흔치 않은 기회였다.</p>\n<h2>Reference</h2>\n<p><a href=\"https://shopify.engineering/javascript-in-webassembly-for-shopify-functions\">Bringing Javascript to WebAssembly for Shopify Functions</a></p>\n<p><a href=\"https://news.hada.io/topic?id=9289\">Javy - JS to WebAssembly 툴체인</a></p>\n<p><a href=\"https://github.com/bytecodealliance/javy\">Javy Github</a></p>\n<p><a href=\"https://bellard.org/quickjs/\">QuickJS</a></p>","frontmatter":{"title":"Javy를 왜 만든 걸까?","date":"June 09, 2023","description":"JS to WebAssembly? 어째서?"}},"previous":{"fields":{"slug":"/svgo-viewbox/"},"frontmatter":{"title":"svgo에서 viewBox를 지우는 이유"}},"next":{"fields":{"slug":"/color-picker/"},"frontmatter":{"title":"Colorpicker 만들기"}}},"pageContext":{"id":"edfbf6bc-63de-53e4-a257-607716c74763","previousPostId":"58d0a865-54bc-57df-ab78-26921c8ba6a0","nextPostId":"9b9671f9-7ebc-541a-82a4-040d56485a6c"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}