{"componentChunkName":"component---src-templates-blog-post-js","path":"/prisma-overwrite-env/","result":{"data":{"site":{"siteMetadata":{"title":"블로그 공사중"}},"markdownRemark":{"id":"8d6f3d58-15d7-557e-8d74-9d16b289e611","excerpt":"사건의 발단 prisma 작업을 하고 있을 때의 일이다.\n prisma 코드만 따로 패키징을 해서 돌려보는데, 자꾸 env 관련 문제가 생겼다.\nenv에 넣어둔 값을 찾을 수 없다며 오류를 내게 된 것이다. 난 분명 env…","html":"<h2>사건의 발단</h2>\n<p>prisma 작업을 하고 있을 때의 일이다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 480px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1ef5b96fc29db37dad3af03ba1cef692/e85cb/slack.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA40lEQVR42p2Qy26DMBBF+f//6KKbfksUqQ+JigRCYmODH4BNCQ6nglUXVRcdaTSaq9Hcq5O9vR4xxtA0DdM0EWNkXVf+W9nL8xOfec7xcKCuSlQj8dbSe0erFUPfM4XAFAPWmF23ptvv2rZFCLGH6bqOeZ7J0pKQZkCanpNwlNJyUZZKGs43RXnTFHWzz/x8pRLbLnkvamrR7CbbM+ccKSWyLaYxHqE8Sp9QRiOvFUprRDcgOo+LCz7e8dOCDXfC/MDGhfQLmWzTUhz5GkYeoWCJGnf5IFhB3w/EcfiD2Lrz/tnfrS9/FacpmFMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack\"\n        title=\"\"\n        src=\"/static/1ef5b96fc29db37dad3af03ba1cef692/e85cb/slack.png\"\n        srcset=\"/static/1ef5b96fc29db37dad3af03ba1cef692/5a46d/slack.png 300w,\n/static/1ef5b96fc29db37dad3af03ba1cef692/e85cb/slack.png 480w\"\n        sizes=\"(max-width: 480px) 100vw, 480px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>prisma 코드만 따로 패키징을 해서 돌려보는데, 자꾸 env 관련 문제가 생겼다.\nenv에 넣어둔 값을 찾을 수 없다며 오류를 내게 된 것이다. 난 분명 env 파일을 넣어 뒀는데?</p>\n<h2>무슨 일이 일어나고 있나요?</h2>\n<p>그래서 .env 파일을 이곳저곳에 넣어보다가,\nprocess.env가 Prisma가 있는 패키지에서 가져오는 env만 자꾸 가져온다는 사실을 알게 되었다.</p>\n<p>그렇다. prisma를 가져올 때면 해당 패키지 path에 있는 .env 파일을 가져와서 process.env에 넣어버린다.\n만약 .env 파일이 없다면? process.env에는 <strong>아무 값도 없게 된다!</strong>\n전에는 패키지 안에 Prisma가 있었기 때문에 상관 없었지만, 분리하면서 문제가 생기게 된 것이다.</p>\n<p>관련해서 <a href=\"https://github.com/prisma/prisma/issues/15620\">깃헙 이슈</a>도 <a href=\"https://github.com/prisma/prisma/issues/16890\">몇 개</a> 있었다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/70fb240c88a5e0b5475df016b3b8ed9b/afa26/issue1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABmklEQVR42m2S227UMBiE8/4vxA2XvUCCSgguQKWrFgmxOTh2HMdnez8Up7usEJFGYzvRZOYfd0oohvPI73PPJGaklAgxM887JFItjZVUKKUQk2jvh3FimmaUWnCb5dvwzPfxRPf+6wOPT19YF8OiV2KMeO8JIbR1SpmU0g3H2cHXNfXC0/TCs3il+/TzM6/zL3Iq+BAaYkzEJpC5XC7/gMb3z/2+G04nttUilWZzHusDIWZyqaRciKkQr5zyHSe8s0A9RGlG6UqtaK3p+x5jTItrN4sxG947gvc4a/HOtTEEH97iJvrJsqyJkhPZ99Ti6XZ1ax3LsrQCRrkhpGYWos3U+IJxB/zu/m0kdlv4+OEdP14k0Vv8/ECN0yG4t9efe4ZxZBgFUiqmaWrtLtqgV3OwXtuZtZZSEjXpW9wrN8E98u7wiGpuLea94b3Ja6MxNYc5Z0qpWBdvJV1qadwEow9sxrK50D4Ku9B9IXdIueLDLhybkf3ntf69BU3QW4cQknnWiHlhVhq9eVxI/4X1kZTzUVIIlFJugn8AjUgFv+aA+JAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"issue1\"\n        title=\"\"\n        src=\"/static/70fb240c88a5e0b5475df016b3b8ed9b/c1b63/issue1.png\"\n        srcset=\"/static/70fb240c88a5e0b5475df016b3b8ed9b/5a46d/issue1.png 300w,\n/static/70fb240c88a5e0b5475df016b3b8ed9b/0a47e/issue1.png 600w,\n/static/70fb240c88a5e0b5475df016b3b8ed9b/c1b63/issue1.png 1200w,\n/static/70fb240c88a5e0b5475df016b3b8ed9b/afa26/issue1.png 1258w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n(마법적으로 .env를 덮어쓴다. 와!)</p>\n<p>그렇다. Opened issue다.\n이 이슈 외에도 많은 사람들이 이의를 제기했고,\n시간이 많이 지났음에도 진전된 사항이 없다.\nPrisma쪽에서는 해당 이슈를 고칠 생각이 없는 건가?</p>\n<p>그렇다!</p>\n<h2>왜???</h2>\n<p>위의 이슈도 1년 간 열려있는 걸 보면 고칠 생각이 없다는 걸 알 수 있는데,\n<a href=\"https://www.prisma.io/docs/guides/development-environment/environment-variables/managing-env-files-and-setting-variables\">다음 글</a>을 보면 Prisma 팀의 확고한 의지를 알 수 있다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 707px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABo0lEQVR42p2SW28TMRCF9///GoTErQkkNKFpK0CAxAPQNtBssvdLdnd8W9sHedIkzzDSpzNjW8ezno1G62BGC2sdnPOwznMd8oAHeC2cc96fzhzD+3MeIqrqBj9+PSBJc8TbBOs/MYqqwS7JsIkT/LxbI80K7NKc6+0uxf36EUmaQSl1Mj0aR3leYPZ+icWHazx7/hIX0xk+fv6Cq9Utbm4/4WI65/xyucJsvsTl4grTt3O8eDXB12/f2cQ5dzKNuq7H6voGk8k7vH4zwWy+ABHhfyMSesT9JsdDnOPuMcPvbYay7bGXFnsxoiXDlP1BhZAgEsxAxHXQUHOHJDWSqkdaD0iqAUXTI05LxMUeeUvolWPzmiw6aaG05reTUrGZUppVPr1nBHgYrSCIIIVANxD6gSBogJKC945opdjsiA7mUkCrQ9fGGERhNuGGtm1RNweaQN2gKCumrGrkRclaBOW1CnlZY1N0TGjCWhs6BDqhsasFNiUhqzsk5R570jBacxfh5rMa1oDSBmQ8SLvzUPiTrYfQjjektiBpMLp/HO/Tb/MXNRn8xKfmWR4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"prisma\"\n        title=\"\"\n        src=\"/static/2ac62272ab5c058f6d449e12c425a529/394f7/prisma.png\"\n        srcset=\"/static/2ac62272ab5c058f6d449e12c425a529/5a46d/prisma.png 300w,\n/static/2ac62272ab5c058f6d449e12c425a529/0a47e/prisma.png 600w,\n/static/2ac62272ab5c058f6d449e12c425a529/394f7/prisma.png 707w\"\n        sizes=\"(max-width: 707px) 100vw, 707px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n정말 놀라운 점은, 문서에 \".env 파일을 사용하지 말 것\" 이라고 당당히 붙여놓았다는 점이다.</p>\n<p>따라서, 결국 prisma는 .env 관련 설정들을 제공할 생각이 없고, 우리는 다른 방법을 생각해야 한다.</p>\n<h2>어떻게 해결하지?</h2>\n<p>사실 해결책은 어이없을 정도로 간단한데, <code>dotenv-cli</code> 등의 패키지로 env를 넣으면 된다.</p>\n<deckgo-highlight-code language=\"bash\"  >\n          <code slot=\"code\">dotenv -e .env -- pnpm dev</code>\n        </deckgo-highlight-code>\n<p>이러면 .env 파일을 읽는 것이 아닌, system environment로 nodejs에 들어가게 되기 때문이다.</p>\n<p>아니면 Prisma import 뒤에 dotenv 등으로 로드하면 되는데, 이건 코드 중간에 집어넣어야 하므로 별로인 것 같아 패스.</p>","frontmatter":{"title":"Prisma는 process.env를 강제로 덮어씌운다.","date":"November 09, 2023","description":"아오"}},"previous":{"fields":{"slug":"/better-uptime/"},"frontmatter":{"title":"Better Uptime! - 더 나은 On-call을 위하여"}},"next":{"fields":{"slug":"/about/"},"frontmatter":{"title":"About"}}},"pageContext":{"id":"8d6f3d58-15d7-557e-8d74-9d16b289e611","previousPostId":"41bd7301-19a0-55ec-a554-625b31584016","nextPostId":"2d6f7e10-7009-587e-8879-e07132c679c6"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}